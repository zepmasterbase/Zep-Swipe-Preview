<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zep Swipe Login</title>

<!-- Tailwind + Fonts + Icons -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --neon-blue: #00f0ff;
  --neon-pink: #ff00f0;
  --neon-purple: #9b59b6;
  --neon-green: #3affc1;
  --glass: rgba(255,255,255,0.05);
}

body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: radial-gradient(circle at top, #0b0520 0%, #120b2e 100%);
  color: #fff;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* HEADER */
.header {
  width: 100%;
  padding: 1rem 1.5rem;
  position: fixed;
  top: 0;
  left: 0;
  backdrop-filter: blur(12px);
  background: rgba(15,5,32,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
  border-radius: 0 0 1.5rem 1.5rem;
  font-family: 'Orbitron', sans-serif;
  font-size: 1.3rem;
  font-weight: 700;
  background: linear-gradient(90deg, var(--neon-pink), var(--neon-green), var(--neon-blue));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* LOGIN CARD */
.login-card {
  margin: 8rem auto 2rem auto;
  padding: 2rem;
  background: var(--glass);
  backdrop-filter: blur(20px);
  max-width: 400px;
  border-radius: 1.5rem;
  box-shadow: 0 0 25px rgba(0,255,255,0.2);
  text-align: center;
}

.login-card h2 {
  font-family: 'Orbitron', sans-serif;
  font-size: 1.5rem;
  margin-bottom: 1rem;
  color: var(--neon-blue);
}

.input {
  width: 100%;
  padding: 0.75rem;
  margin-bottom: 1rem;
  border-radius: 0.75rem;
  border: none;
  background: rgba(255,255,255,0.1);
  color: #fff;
}

.btn {
  width: 100%;
  padding: 0.75rem;
  border-radius: 1rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
  cursor: pointer;
  transition: transform 0.3s;
}

.btn:hover {
  transform: scale(1.03);
}

.btn-gradient {
  background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
  color: #0b0520;
}

.btn-outline {
  border: 2px solid var(--neon-purple);
  color: var(--neon-purple);
  background: transparent;
}

.btn-outline:hover {
  background: rgba(155,89,182,0.2);
}

#recaptcha-container {
  margin-bottom: 1rem;
}

/* FOOTER */
.footer {
  margin-top: auto;
  padding: 1rem;
  text-align: center;
  font-size: 0.8rem;
  color: #888;
}
.footer a {
  color: var(--neon-pink);
  margin: 0 0.5rem;
  text-decoration: none;
}
</style>
</head>

<body>
<header class="header">Zep Swipe Login</header>

<div class="login-card">
  <h2>Login / Continue with Phone</h2>
  <input type="text" id="phoneNumber" class="input" placeholder="+234 8012345678">
  <div id="recaptcha-container"></div>
  <button class="btn btn-gradient" id="sendOTP">Send OTP</button>
  <input type="text" id="otp" class="input" placeholder="Enter OTP">
  <button class="btn btn-outline" id="verifyOTP">Verify OTP</button>
</div>

<div class="footer">
  <span>Follow us: </span>
  <a href="https://www.instagram.com/zepswipe?igsh=bXF3anMxODhxZWFs" target="_blank"><i class="fab fa-instagram"></i></a>
  <a href="https://x.com/ZepSwipe?t=r94a0_pgN7ew1xT5L4eOSA&s=09" target="_blank"><i class="fab fa-x-twitter"></i></a>
  <a href="https://x.com/ZepSwipe?t=r94a0_pgN7ew1xT5L4eOSA&s=09" target="_blank"><i class="fab fa-facebook"></i></a>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
apiKey: "AIzaSyBxAQxTvuPCYVAG3eQu4MQfxHRWJB9Q3wI",
authDomain: "zep-swipe-6cb53.firebaseapp.com",
projectId: "zep-swipe-6cb53",
storageBucket: "zep-swipe-6cb53.firebasestorage.app",
messagingSenderId: "895701529881",
appId: "1:895701529881:web:81c6e3e420bfe6cb7dc188",
measurementId: "G-L48WTHMKKZ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Configure Recaptcha
window.recaptchaVerifier = new RecaptchaVerifier('recaptcha-container', {
  'size': 'normal',
  'callback': (response) => {
    console.log('Recaptcha verified');
  }
}, auth);

document.getElementById('sendOTP').addEventListener('click', async () => {
  const phoneNumber = document.getElementById('phoneNumber').value;
  const appVerifier = window.recaptchaVerifier;

  try {
    const confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, appVerifier);
    window.confirmationResult = confirmationResult;
    alert("OTP Sent Successfully!");
  } catch (error) {
    alert("Error sending OTP: " + error.message);
    console.error(error);
  }
});

document.getElementById('verifyOTP').addEventListener('click', async () => {
  const code = document.getElementById('otp').value;

  try {
    const result = await window.confirmationResult.confirm(code);
    const user = result.user;
    
    // Check if user exists in Firestore
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);
    if (!userSnap.exists()) {
      // Create user document for first-time login
      await setDoc(userRef, {
        phone: user.phoneNumber,
        role: "student", // default role, can customize
        createdAt: new Date()
      });
    }

    alert("Login successful!");
    // Redirect based on role
    const role = userSnap.exists() ? userSnap.data().role : "student";
    if (role === "student") {
      window.location.href = "student-dashboard.html";
    } else {
      window.location.href = "vendor-dashboard.html";
    }
  } catch (error) {
    alert("Error verifying OTP: " + error.message);
    console.error(error);
  }
});
</script>
</body>
</html>