<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zep Swipe Merchants â€” Wallet</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>

<style>
:root {
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --zep-lime:#a6ff00;
  --glass:rgba(255,255,255,0.06);
  --bg:radial-gradient(circle at 25% 10%, #050018 0%, #000010 100%);
}
body {
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  color:#fff;
  margin:0;
  min-height:100vh;
  overflow-x:hidden;
  padding-bottom:90px;
}

/* ===== Header ===== */
header {
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 18px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(18px);
  border-bottom:1px solid rgba(255,255,255,0.1);
  box-shadow:0 0 18px rgba(0,240,255,0.18);
  position:sticky; top:0; z-index:60;
}
.logo {
  font-family:'Orbitron'; font-weight:700; font-size:1.25rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  text-shadow:0 0 18px rgba(0,240,255,0.6);
}
.logout-btn {
  background:none; border:none; cursor:pointer;
  filter:drop-shadow(0 0 8px var(--zep-blue)); transition:.25s;
}
.logout-btn:hover { transform:scale(1.1); filter:drop-shadow(0 0 12px var(--zep-violet)); }

/* ===== Wallet Section ===== */
main { padding:20px; display:flex; flex-direction:column; align-items:center; gap:20px; }

.glass {
  width:100%; max-width:680px;
  background:var(--glass);
  border-radius:18px;
  border:1px solid rgba(255,255,255,0.1);
  padding:22px;
  box-shadow:0 0 25px rgba(0,240,255,0.18);
  backdrop-filter:blur(16px);
  text-align:center;
  animation:pulseCard 3s ease-in-out infinite alternate;
}
@keyframes pulseCard {
  0%{box-shadow:0 0 10px rgba(0,240,255,0.25);}
  100%{box-shadow:0 0 30px rgba(156,77,255,0.45);}
}
.section-title {
  font-family:'Orbitron';
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  font-size:1.25rem; margin-bottom:8px;
}
.wallet-address {
  font-family:'Orbitron';
  font-size:0.95rem;
  opacity:0.9;
  margin-bottom:10px;
}

/* ===== AI Chat Floating Widget ===== */
.ai-chat-btn {
  position:fixed;
  bottom:95px;
  right:20px;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050018;
  font-family:'Orbitron';
  border:none;
  border-radius:999px;
  padding:12px 22px;
  cursor:pointer;
  box-shadow:0 0 25px rgba(0,240,255,0.4);
  font-weight:700;
  z-index:200;
  animation:pulseAI 2s ease-in-out infinite alternate;
}
@keyframes pulseAI {
  0%{box-shadow:0 0 12px rgba(0,240,255,0.4);}
  100%{box-shadow:0 0 30px rgba(156,77,255,0.8);}
}
.ai-chatbox {
  position:fixed;
  bottom:150px;
  right:20px;
  width:280px;
  background:rgba(10,10,25,0.95);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.1);
  box-shadow:0 0 25px rgba(0,240,255,0.25);
  display:none;
  flex-direction:column;
  overflow:hidden;
}
.ai-header {
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050018;
  font-family:'Orbitron';
  font-weight:700;
  text-align:center;
  padding:8px;
}
.ai-messages {
  flex:1;
  max-height:220px;
  overflow-y:auto;
  padding:10px;
  color:#fff;
  font-size:0.85rem;
}
.ai-input {
  display:flex;
  border-top:1px solid rgba(255,255,255,0.1);
}
.ai-input input {
  flex:1;
  border:none;
  background:rgba(255,255,255,0.05);
  color:#fff;
  padding:8px;
  outline:none;
}
.ai-input button {
  border:none;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050018;
  font-weight:700;
  padding:8px 14px;
  cursor:pointer;
}

/* ===== Footer ===== */
footer {
  position:fixed; bottom:0; left:0; width:100%;
  background:rgba(15,15,30,0.9);
  backdrop-filter:blur(12px);
  border-top:1px solid rgba(255,255,255,0.1);
  display:flex; justify-content:space-around; align-items:center;
  padding:10px 0; z-index:50;
}
.footer-icon svg {
  width:28px; height:28px; stroke:var(--zep-blue);
  filter:drop-shadow(0 0 8px var(--zep-violet)); transition:.25s;
}
.footer-icon:hover svg {
  stroke:var(--zep-violet); transform:scale(1.1);
  filter:drop-shadow(0 0 12px var(--zep-blue));
}
</style>
</head>

<body>
<header>
  <div class="logo">Merchant Wallet</div>
  <button class="logout-btn" onclick="logout()" title="Logout">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#00f0ff" viewBox="0 0 24 24" width="26" height="26" stroke-width="1.8">
      <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
      <polyline points="10 17 15 12 10 7"/>
      <line x1="15" y1="12" x2="3" y2="12"/>
    </svg>
  </button>
</header>

<main>
  <div class="glass">
    <h2 class="section-title">ðŸ’³ Connected Wallet</h2>
    <p class="wallet-address" id="walletAddress">â€”</p>
    <h3 class="section-title">$ZAC Balance</h3>
    <p id="zacBalance" style="font-family:'Orbitron'; font-size:1.4rem;">0 ZAC</p>
    <p id="usdValue" style="font-size:1rem; opacity:.85;">â‰ˆ $0.00 USD</p>
  </div>

  <div class="glass">
    <h2 class="section-title">ðŸ’¬ Zep AI Insights</h2>
    <p style="opacity:.85;">Zep AI is analyzing your wallet and marketplace activity...  
    Ask me anything about sales, payouts, or performance insights.</p>
  </div>
</main>

<!-- Floating Zep AI Widget -->
<button class="ai-chat-btn" onclick="toggleAI()">ðŸ’¬ Ask Zep AI</button>
<div class="ai-chatbox" id="aiChat">
  <div class="ai-header">Zep AI</div>
  <div class="ai-messages" id="aiMessages">
    <p>ðŸ‘‹ Hey there! Iâ€™m Zep AI. Want to check your balance or learn how to optimize your store?</p>
  </div>
  <div class="ai-input">
    <input type="text" id="aiInput" placeholder="Ask me anything..." onkeypress="if(event.key==='Enter')sendAI()">
    <button onclick="sendAI()">Send</button>
  </div>
</div>

<footer>
  <a href="merchants-dashboard.html" class="footer-icon" title="Home">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8"><path d="M3 9.5l9-7 9 7v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-10z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
  </a>
  <a href="wallet.html" class="footer-icon" title="Wallet">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8"><rect x="3" y="6" width="18" height="12" rx="2"/><path d="M16 12h4"/></svg>
  </a>
  <a href="zepshop.html" class="footer-icon" title="Store">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8"><path d="M3 6h18l-2 12H5z"/></svg>
  </a>
  <a href="profile.html" class="footer-icon" title="Profile">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8"><circle cx="12" cy="7" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>
  </a>
</footer>

<script>
const tokenABI = [
  "function balanceOf(address owner) view returns (uint256)",
  "function decimals() view returns (uint8)"
];
const ZAC_TOKEN_ADDRESS = "0xfe4119a9cac1425d808526905e92386b4234bf2a";

// Fetch real-time ZAC balance
async function fetchZACBalance(wallet){
  try {
    const provider = new ethers.JsonRpcProvider("https://mainnet.base.org");
    const contract = new ethers.Contract(ZAC_TOKEN_ADDRESS, tokenABI, provider);
    const decimals = await contract.decimals();
    const balance = await contract.balanceOf(wallet);
    const formatted = Number(ethers.formatUnits(balance, decimals)).toFixed(2);

    const simulatedZacPrice = 0.15; // Simulated for MVP
    const zacUSD = (formatted * simulatedZacPrice).toFixed(2);

    document.getElementById('zacBalance').textContent = `${formatted} ZAC`;
    document.getElementById('usdValue').textContent = `â‰ˆ $${zacUSD} USD`;
  } catch (err) {
    console.error("Fetch error:", err);
    const fallback = localStorage.getItem('zacBalance') || 25;
    const simulatedZacPrice = 0.15;
    const zacUSD = (fallback * simulatedZacPrice).toFixed(2);
    document.getElementById('zacBalance').textContent = `${fallback} ZAC (Test Credit)`;
    document.getElementById('usdValue').textContent = `â‰ˆ $${zacUSD} USD`;
  }
}

// Simple Zep AI response logic
function sendAI(){
  const input = document.getElementById('aiInput');
  const msg = input.value.trim();
  if(!msg) return;
  const box = document.getElementById('aiMessages');
  const userMsg = document.createElement('p');
  userMsg.textContent = "ðŸ§‘ " + msg;
  box.appendChild(userMsg);
  input.value = '';

  const aiReply = document.createElement('p');
  aiReply.textContent = "ðŸ¤– ...thinking";
  box.appendChild(aiReply);

  setTimeout(()=>{
    aiReply.textContent = generateAIResponse(msg);
    box.scrollTop = box.scrollHeight;
  }, 800);
}

function generateAIResponse(q){
  const lower = q.toLowerCase();
  if(lower.includes('balance')) return "ðŸ’° Your current ZAC wallet balance is displayed above. It syncs live with Base Network.";
  if(lower.includes('withdraw')) return "ðŸ’¸ Withdrawals will be available in the next Zep Swipe update â€” stay tuned!";
  if(lower.includes('earn')) return "ðŸš€ You earn ZAC as you get store likes and verified sales. Keep growing your engagement!";
  if(lower.includes('trend')) return "ðŸ“Š Latest merchant trend: Digital courses and gadgets are dominating student markets!";
  return "ðŸ¤– Iâ€™m still learning â€” but I can help you track sales, likes, and your ZAC balance anytime.";
}

function toggleAI(){
  const ai = document.getElementById('aiChat');
  ai.style.display = ai.style.display === 'flex' ? 'none' : 'flex';
}

window.addEventListener('load', async ()=>{
  const user = JSON.parse(localStorage.getItem('zepUser'));
  if(!user || !user.wallet){
    window.location.href='index.html';
    return;
  }

  const shortAddr = `${user.wallet.slice(0,6)}...${user.wallet.slice(-4)}`;
  document.getElementById('walletAddress').textContent = shortAddr;
  await fetchZACBalance(user.wallet);
});

function logout(){
  localStorage.removeItem('zepUser');
  window.location.href='index.html';
}
</script>
</body>
</html>