<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zep Swipe — Request / POS</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600,700&family=Orbitron:wght@600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<style>
:root {
  --bg: #08051a;
  --glass: rgba(255,255,255,0.04);
  --accent-a: #00f0ff;
  --accent-b: #ff00f0;
  --gradient: linear-gradient(90deg,var(--accent-a),var(--accent-b));
}
body {
  background: radial-gradient(circle at 20% 20%, #161233 0%, var(--bg) 70%);
  color: #e9eeff;
  font-family: 'Poppins', sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 1rem;
}
.glass {
  background: linear-gradient(160deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 18px;
  box-shadow: 0 8px 40px rgba(0,0,0,0.5);
  backdrop-filter: blur(20px);
}
.status-bar {
  height: 8px;
  background: rgba(255,255,255,0.05);
  border-radius: 999px;
  overflow: hidden;
}
.status-bar-inner {
  height: 100%;
  width: 40%;
  background: var(--gradient);
  transition: width 0.6s ease;
}
.input-card input, .input-card textarea {
  background: var(--glass);
  border: none;
  border-radius: 12px;
  width: 100%;
  color: #e9eeff;
  padding: 0.8rem 1rem;
  font-size: 1rem;
  outline: none;
}
.input-card input::placeholder, .input-card textarea::placeholder {
  color: #9da5c7;
}
.request-btn {
  background: var(--gradient);
  border: none;
  border-radius: 14px;
  padding: 0.9rem;
  width: 100%;
  color: #0a0a14;
  font-weight: 700;
  font-size: 1rem;
  cursor: pointer;
  transition: transform .2s, box-shadow .3s;
}
.request-btn:hover {
  box-shadow: 0 0 20px rgba(0,240,255,0.3);
  transform: translateY(-2px);
}
.contact {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  overflow: hidden;
  cursor: pointer;
  position: relative;
  transition: transform .2s, box-shadow .2s;
}
.contact img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.contact[data-active="true"] {
  box-shadow: 0 0 15px rgba(0,240,255,0.5);
  transform: translateY(-4px);
}
.recent-card {
  animation: slideUp .4s ease both;
}
@keyframes slideUp {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

/* POS (Vendor Only) */
.pos-section {
  background: var(--glass);
  padding: 1.2rem;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.06);
  text-align: center;
  display: none;
  animation: fadeIn .5s ease both;
}
.pos-section.active {
  display: block;
}
.pos-select {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 1rem;
}
.pos-select button {
  padding: 0.6rem 1rem;
  border-radius: 9999px;
  border: none;
  background: rgba(255,255,255,0.05);
  color: #e9eeff;
  cursor: pointer;
  transition: all 0.3s ease;
}
.pos-select button.active {
  background: var(--gradient);
  color: #0a0a14;
  font-weight: 600;
  box-shadow: 0 0 12px rgba(0,240,255,0.3);
}
.qr-box {
  margin-top: 1rem;
}
.qr-placeholder {
  width: 160px;
  height: 160px;
  margin: 0 auto;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>

<main class="w-full max-w-md glass p-6 space-y-5">
  <!-- Progress Bar -->
  <div class="status-bar"><div class="status-bar-inner" id="statusBar"></div></div>
  <div class="flex justify-between text-sm text-gray-400">
    <span>Status</span><span id="pendingCount">3 Pending</span>
  </div>

  <!-- Amount + Note -->
  <div class="input-card space-y-3">
    <input id="amount" type="number" placeholder="Enter amount (e.g. 250)" />
    <textarea id="note" rows="2" placeholder="Add a note (optional)"></textarea>
  </div>

  <!-- Contact Selector -->
  <div>
    <h3 class="text-sm text-gray-300 mb-2 font-medium">Select Contact</h3>
    <div id="contacts" class="flex gap-3 overflow-x-auto pb-2">
      <div class="contact" data-user="Alice" data-active="false"><img src="https://i.pravatar.cc/60?img=1" alt="Alice"></div>
      <div class="contact" data-user="Bob" data-active="false"><img src="https://i.pravatar.cc/60?img=2" alt="Bob"></div>
      <div class="contact" data-user="Charlie" data-active="false"><img src="https://i.pravatar.cc/60?img=3" alt="Charlie"></div>
      <div class="contact" data-user="Diana" data-active="false"><img src="https://i.pravatar.cc/60?img=4" alt="Diana"></div>
    </div>
  </div>

  <!-- Request Button -->
  <button id="requestBtn" class="request-btn">Request</button>

  <!-- POS (Vendor Only) -->
  <section id="posSection" class="pos-section">
    <h3 class="text-lg font-semibold mb-2 text-cyan-300">Vendor POS — Accept Payments</h3>
    <div class="pos-select">
      <button class="active" data-method="ZAC">ZAC</button>
      <button data-method="USDT">USDT</button>
    </div>
    <input id="posAmount" type="number" placeholder="Enter amount to receive" class="input-card mt-2" />
    <button id="generateQR" class="request-btn mt-2">Generate QR</button>
    <div class="qr-box mt-3">
      <canvas id="qrCanvas" class="qr-placeholder"></canvas>
      <p id="paymentTag" class="text-sm text-gray-300 mt-1">Scan QR to pay vendor_001 (ZAC)</p>
    </div>
  </section>

  <!-- Recent Requests -->
  <div class="mt-5">
    <h3 class="text-sm text-gray-300 mb-2 font-medium">Recent Requests</h3>
    <div id="recentList" class="space-y-3"></div>
  </div>
</main>

<script>
/* --- SIMULATED SESSION ROLE --- */
const userRole = "vendor"; // Change to 'student' to hide POS

const posSection = document.getElementById('posSection');
if(userRole==="vendor") posSection.classList.add('active');

/* --- POS Buttons --- */
const posButtons = document.querySelectorAll('.pos-select button');
const paymentTag = document.getElementById('paymentTag');
let selectedMethod = 'ZAC';

posButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    posButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedMethod = btn.dataset.method;
    paymentTag.textContent = `Scan QR to pay vendor_001 (${selectedMethod})`;
  });
});

/* --- Generate QR --- */
const generateQR = document.getElementById('generateQR');
const qrCanvas = document.getElementById('qrCanvas');
const posAmountInput = document.getElementById('posAmount');

generateQR.addEventListener('click', () => {
  const amount = Number(posAmountInput.value);
  if(!amount || amount <=0) return alert("Enter a valid amount");

  const payload = {
    vendor: "vendor_001",
    method: selectedMethod,
    amount
  };
  QRCode.toCanvas(qrCanvas, JSON.stringify(payload), {width:160, color:{dark:'#00f0ff', light:'#08051a'}}, err=>{
    if(err) console.error(err);
    paymentTag.textContent = `Scan QR to pay ${payload.vendor} (${payload.method}) — ${payload.amount}`;
  });
});

/* --- Contacts --- */
const contacts = document.querySelectorAll('.contact');
let selectedUser = null;
contacts.forEach(c=>{
  c.addEventListener('click', ()=>{
    contacts.forEach(o=>o.dataset.active='false');
    c.dataset.active='true';
    selectedUser = c.dataset.user;
  });
});

/* --- Request Logic --- */
const requestBtn = document.getElementById('requestBtn');
const amountInput = document.getElementById('amount');
const noteInput = document.getElementById('note');
const recentList = document.getElementById('recentList');
const statusBar = document.getElementById('statusBar');
const pendingCount = document.getElementById('pendingCount');

let pending = 3;
function updatePendingDisplay(){
  statusBar.style.width = Math.min(100,pending*20)+'%';
  pendingCount.textContent = `${pending} Pending`;
}
updatePendingDisplay();

function addRecent(user, amount, note, status){
  const card = document.createElement('div');
  card.className = 'recent-card glass p-3 rounded-lg';
  card.innerHTML = `
    <div class="flex justify-between items-center">
      <div>
        <div class="font-semibold">${user}</div>
        <div class="text-sm text-gray-400">${note||'No note added'}</div>
      </div>
      <div class="text-right">
        <div class="font-bold text-lg">${amount} ZAC</div>
        <span class="text-xs px-2 py-1 rounded-md ${status==='Accepted'?'bg-green-600/40':'bg-yellow-600/30'}">${status}</span>
      </div>
    </div>
  `;
  recentList.prepend(card);
}

/* --- Backend Sim --- */
function simulateRequest(payload){ return new Promise