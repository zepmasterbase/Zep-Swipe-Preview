<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ParcelOn â€” Delivery Dashboard</title>

<!-- Tailwind CDN for quick layout + utility classes -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Google font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- FontAwesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Leaflet map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-sA+e2Hk2VfLJ4N0wNq4b0s2p3b6E0Qv3r1gP6b9gS+g="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-XQoYMqMTK8LvdlxUMkN3prZb2v3sY7b3t0u1h6Z8a9g="
  crossorigin=""></script>

<style>
  :root{
    --bg-1: #04020b;
    --panel: rgba(255,255,255,0.04);
    --neon: #00f0ff;
    --neon-2: #7a00ff;
    --accent: linear-gradient(90deg, #00f0ff, #7a00ff, #ff00f0);
    --glass-border: rgba(255,255,255,0.06);
    --glow: 0 6px 30px rgba(0,240,255,0.07), inset 0 1px 0 rgba(255,255,255,0.02);
  }

  html,body { height:100%; background: radial-gradient(circle at 10% 10%, #07102a 0%, var(--bg-1) 60%); font-family: Inter, system-ui, sans-serif; color: #e6eef8; }
  .app { min-height:100vh; display:flex; flex-direction:column; }

  /* Header */
  .header {
    position: sticky;
    top: 0;
    z-index:60;
    backdrop-filter: blur(8px);
    background: linear-gradient(180deg, rgba(10,10,20,0.45), rgba(10,10,20,0.25));
    border-bottom: 1px solid rgba(255,255,255,0.03);
    padding: 18px 20px;
  }
  .brand { font-weight:800; letter-spacing:2px; font-size:1.1rem; color:transparent;
    background: var(--accent); -webkit-background-clip:text; }
  .sub { font-size:0.85rem; color: rgba(255,255,255,0.65); }

  /* Layout */
  .container { display:grid; grid-template-columns: 1fr 420px; gap:18px; padding:20px; max-width:1200px; margin:0 auto; width:100%; }
  @media (max-width: 980px){ .container { grid-template-columns: 1fr; } }

  /* Panels */
  .panel {
    background: var(--panel);
    border-radius: 14px;
    border: 1px solid var(--glass-border);
    padding: 14px;
    box-shadow: var(--glow);
  }

  /* Map */
  #map { width:100%; height:70vh; border-radius:12px; border:1px solid rgba(255,255,255,0.02); overflow:hidden; }
  @media (max-width:980px){ #map { height:48vh; } }

  /* Controls */
  .controls { display:flex; gap:10px; align-items:center; }
  .btn {
    background: linear-gradient(90deg, rgba(0,240,255,0.08), rgba(122,0,255,0.06));
    color: var(--neon);
    border: 1px solid rgba(0,240,255,0.12);
    padding: 10px 14px;
    border-radius: 999px;
    display:inline-flex; gap:8px; align-items:center;
    cursor:pointer; font-weight:600;
    transition: transform .12s, box-shadow .12s;
  }
  .btn:hover { transform: translateY(-4px); box-shadow: 0 8px 30px rgba(0,240,255,0.08); }
  .btn.secondary {
    color: #cfefff; border:1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02);
  }

  /* Deliveries list */
  .deliveries {
    display:flex; flex-direction:column; gap:10px; max-height:48vh; overflow:auto; padding-right:6px;
  }
  .delivery {
    display:flex; justify-content:space-between; align-items:center; gap:8px; padding:10px; border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(0,240,255,0.03);
    transition: transform .12s;
  }
  .delivery:hover { transform: translateY(-4px); box-shadow: 0 6px 20px rgba(0,240,255,0.04); }
  .meta { display:flex; gap:12px; align-items:center; }
  .id-badge { font-size:0.8rem; color:#9adfff; background: rgba(0,240,255,0.04); padding:6px 8px; border-radius:8px; border:1px solid rgba(0,240,255,0.06); }
  .names { font-size:0.92rem; color:#dff6ff; }
  .eta { font-size:0.82rem; color:#bfeeff; }
  .status { padding:6px 8px; border-radius:999px; font-weight:700; font-size:0.78rem; }
  .status.pending { background: linear-gradient(90deg,#2b2b3b,#1b1b2b); color:#ffd76b; border:1px solid rgba(255,215,107,0.08);}
  .status.intransit { background: linear-gradient(90deg,#002b34,#003b4a); color:#8ef8b8; border:1px solid rgba(0,240,255,0.08);}
  .status.delivered { background: linear-gradient(90deg,#1b1b2b,#2b2b39); color:#ff9ad7; border:1px solid rgba(255,90,200,0.06);}
  .actions { display:flex; gap:8px; align-items:center; }

  /* Small neon indicators */
  .neo-circle {
    width:46px; height:46px; border-radius:50%; display:flex; align-items:center; justify-content:center;
    background: radial-gradient(circle at 30% 30%, rgba(0,240,255,0.08), rgba(122,0,255,0.06));
    border:1px solid rgba(0,240,255,0.12);
    box-shadow: 0 6px 20px rgba(0,240,255,0.05);
  }

  /* Modal */
  .modal-back { position:fixed; inset:0; background:rgba(5,5,10,0.6); display:none; place-items:center; z-index:80; }
  .modal { width:100%; max-width:520px; background:var(--panel); border-radius:14px; padding:18px; border:1px solid var(--glass-border); box-shadow:var(--glow); }

  input, select, textarea {
    background: rgba(255,255,255,0.02);
    border:1px solid rgba(255,255,255,0.04);
    color: #dbeffd; padding:10px; border-radius:10px; width:100%; outline:none; margin-bottom:10px;
  }
  label { font-size:0.85rem; color:#9ddfff; margin-bottom:6px; display:block; }

  /* footer mini */
  .mini-foot { display:flex; gap:10px; justify-content:space-between; align-items:center; margin-top:12px; color:#9ddfff; font-size:0.9rem; opacity:0.9; }
  .small { font-size:0.8rem; opacity:0.7; color:#9ddfff; }

  /* nice scroll */
  .deliveries::-webkit-scrollbar{ width:8px;}
  .deliveries::-webkit-scrollbar-thumb{ background: linear-gradient(180deg,#00f0ff22,#7a00ff22); border-radius:20px; }

  /* tiny animations */
  .float { animation: floatUp 4s ease-in-out infinite; }
  @keyframes floatUp { 0%{ transform:translateY(0)} 50%{ transform:translateY(-6px)} 100%{ transform:translateY(0)} }

</style>
</head>
<body>
<div class="app">
  <!-- header -->
  <header class="header">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div>
        <div class="brand">ParcelOn</div>
        <div class="sub">Delivering the future â€” USDT payments Â· Smart tracking</div>
      </div>

      <div class="flex items-center gap-4">
        <div class="small">Connected: <span id="connStatus" class="text-green-300">Live</span></div>
        <button class="btn" id="btnQuickSend"><i class="fa-solid fa-paper-plane"></i> Send Package</button>
        <button class="btn secondary" id="btnTrack"><i class="fa-solid fa-location-dot"></i> Track Package</button>
      </div>
    </div>
  </header>

  <!-- main layout -->
  <div class="container">
    <!-- left: map -->
    <section class="panel">
      <div class="flex items-center justify-between mb-3">
        <div>
          <div style="font-weight:700; font-size:1.1rem; color:#e6f9ff;">Real-time Tracking</div>
          <div class="small">Map shows active delivery vehicles and parcels</div>
        </div>
        <div class="small">Last update: <span id="lastUpdate">--:--</span></div>
      </div>

      <div id="map" aria-label="Map showing package locations"></div>

      <div class="mini-foot">
        <div>Active deliveries: <strong id="activeCount">0</strong></div>
        <div>Pending pickups: <strong id="pendingCount">0</strong></div>
        <div>Delivered today: <strong id="deliveredCount">0</strong></div>
      </div>
    </section>

    <!-- right: deliveries list -->
    <aside class="panel">
      <div class="flex items-center justify-between mb-4">
        <div style="font-weight:700; font-size:1.05rem;">Current Deliveries</div>
        <div class="small">Live Â· Glass UI</div>
      </div>

      <div class="deliveries" id="deliveriesList" role="list" aria-live="polite">
        <!-- items inserted by JS -->
      </div>

      <div style="margin-top:12px;">
        <div style="font-weight:700; margin-bottom:8px;">Quick Filters</div>
        <div class="flex gap-2">
          <button class="btn secondary" onclick="filterList('all')">All</button>
          <button class="btn" onclick="filterList('pending')">Pending</button>
          <button class="btn" onclick="filterList('intransit')">In transit</button>
          <button class="btn" onclick="filterList('delivered')">Delivered</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Send Package Modal -->
  <div class="modal-back" id="modalBack">
    <div class="modal">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
        <div style="font-weight:800; font-size:1.05rem; color:#cfefff;">Create Shipment</div>
        <button class="text-pink-400" onclick="closeModal()">âœ•</button>
      </div>

      <form id="sendForm" onsubmit="return handleSend(event)">
        <label for="sender">Sender Name</label>
        <input id="sender" required placeholder="Alice (John's books)" />

        <label for="receiver">Receiver Name</label>
        <input id="receiver" required placeholder="Bob (Dorm 3B)" />

        <label for="address">Destination (City/Address)</label>
        <input id="address" required placeholder="Accra, Ghana â€” Legon Campus" />

        <label for="eta">ETA (minutes)</label>
        <input id="eta" type="number" min="5" value="30" required />

        <label for="note">Note (optional)</label>
        <textarea id="note" placeholder="Pickup instructions..."></textarea>

        <div style="display:flex; gap:10px; margin-top:8px;">
          <button class="btn" type="submit"><i class="fa-solid fa-paper-plane"></i> Create & Broadcast</button>
          <button class="btn secondary" type="button" onclick="closeModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Track Modal -->
  <div class="modal-back" id="trackBack">
    <div class="modal">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
        <div style="font-weight:800; font-size:1.05rem; color:#cfefff;">Track Package</div>
        <button class="text-pink-400" onclick="closeTrack()">âœ•</button>
      </div>

      <label for="trackId">Enter package ID</label>
      <input id="trackId" placeholder="e.g. PO-1002" />
      <div style="display:flex; gap:10px; margin-top:12px;">
        <button class="btn" onclick="handleTrack()">Locate</button>
        <button class="btn secondary" onclick="closeTrack()">Close</button>
      </div>
      <div style="margin-top:10px; color:#bfeeff;" id="trackFeedback"></div>
    </div>
  </div>

</div>

<script>
/* ----------------------------------------------------
   Simulated real-time delivery dashboard behavior
   - Map with Leaflet (no API key required for basic tiles)
   - Fake "WebSocket" using setInterval for live updates
   - Send Package: adds entry and marker
   - Track Package: flyTo the marker
----------------------------------------------------*/

/* Helper: random coordinates around an anchor city (example: Accra) */
function randomNearby(lat, lon, radiusMeters=8000) {
  const r = radiusMeters/111300 * Math.sqrt(Math.random()); // degrees
  const theta = Math.random() * 2 * Math.PI;
  return [lat + r*Math.cos(theta), lon + r*Math.sin(theta)];
}

/* Seed data */
let deliveries = [
  { id: 'PO-1001', sender:'Alice', receiver:'Bob', eta:22, status:'intransit', lat:5.6037, lon:-0.1870, note:'Leave at reception' },
  { id: 'PO-1002', sender:'CampusStore', receiver:'Cici', eta:10, status:'pending', lat:5.6050, lon:-0.1890, note:'Pickup from store' },
  { id: 'PO-1003', sender:'VendorX', receiver:'Duke', eta:5, status:'intransit', lat:5.6100, lon:-0.1800, note:'' },
];
let markers = {}; // map id -> marker

/* Init map */
const map = L.map('map', { zoomControl:true, attributionControl:false }).setView([5.6037, -0.1870], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  opacity: 0.9
}).addTo(map);

/* Custom neon icon factory */
function neonIcon(color='#00f0ff', size=36, inner='ðŸ“¦') {
  const svg = encodeURIComponent(`
  <svg xmlns='http://www.w3.org/2000/svg' width='${size}' height='${size}' viewBox='0 0 48 48'>
    <defs>
      <filter id="glo"><feGaussianBlur stdDeviation="1.2" result="b" /></filter>
    </defs>
    <circle cx="24" cy="24" r="20" fill="none" stroke="${color}" stroke-width="2.5" opacity="0.95" />
    <g font-size="20" transform="translate(10,31)"><text fill="${color}" font-family="Arial">${inner}</text></g>
  </svg>`);
  return L.icon({ iconUrl: `data:image/svg+xml;utf8,${svg}`, iconSize: [48,48], iconAnchor:[24,48], popupAnchor:[0,-38] });
}

/* Render list and markers */
function renderList(filter='all') {
  const list = document.getElementById('deliveriesList');
  list.innerHTML = '';
  const filtered = deliveries.filter(d => filter==='all' ? true : d.status===filter);
  filtered.forEach(d => {
    const el = document.createElement('div');
    el.className = 'delivery';
    el.innerHTML = `
      <div class="meta">
        <div class="neo-circle float" title="Package"><i class="fa-solid fa-box-open" style="color:var(--neon);"></i></div>
        <div>
          <div class="id-badge">${d.id}</div>
          <div class="names">${d.sender} â†’ ${d.receiver}</div>
          <div class="eta">ETA: ${d.eta} min â€¢ ${d.note ? d.note : ''}</div>
        </div>
      </div>
      <div style="display:flex; flex-direction:column; align-items:flex-end; gap:6px;">
        <div class="status ${d.status==='pending'?'pending': d.status==='intransit'?'intransit':'delivered'}">${d.status.toUpperCase()}</div>
        <div class="actions">
          <button class="btn secondary" onclick="zoomTo('${d.id}')"><i class="fa-solid fa-location-dot"></i></button>
          <button class="btn" onclick="markDelivered('${d.id}')"><i class="fa-solid fa-check"></i></button>
        </div>
      </div>
    `;
    list.appendChild(el);
  });

  document.getElementById('activeCount').innerText = deliveries.filter(d => d.status !== 'delivered').length;
  document.getElementById('pendingCount').innerText = deliveries.filter(d => d.status === 'pending').length;
  document.getElementById('deliveredCount').innerText = deliveries.filter(d => d.status === 'delivered').length;
}

/* place or update marker */
function upsertMarker(d) {
  if (markers[d.id]) {
    markers[d.id].setLatLng([d.lat, d.lon]);
    markers[d.id].setPopupContent(`${d.id}<br>${d.sender} â†’ ${d.receiver}<br>Status: ${d.status}`);
  } else {
    const icon = neonIcon(d.status==='delivered' ? '#ff9ad7' : (d.status==='pending' ? '#ffd76b' : '#00f0ff'));
    const m = L.marker([d.lat, d.lon], { icon }).addTo(map);
    m.bindPopup(`${d.id}<br>${d.sender} â†’ ${d.receiver}<br>Status: ${d.status}`);
    markers[d.id] = m;
  }
}

/* initial markers */
deliveries.forEach(d => upsertMarker(d));
renderList();

/* Fake real-time updates: periodically move in-transit packages, countdown ETA */
function liveTick() {
  deliveries.forEach(d => {
    if (d.status === 'intransit') {
      // move slightly towards a random nearby target
      const [newLat, newLon] = randomNearby(d.lat, d.lon, 400);
      d.lat = (d.lat*2 + newLat)/3;
      d.lon = (d.lon*2 + newLon)/3;
      d.eta = Math.max(0, d.eta - Math.round(Math.random()*3));
      if (d.eta === 0) {
        d.status = 'delivered';
      }
      upsertMarker(d);
    } else if (d.status === 'pending') {
      // maybe go to intransit sometimes
      if (Math.random() > 0.85) { d.status = 'intransit'; }
    }
  });
  const now = new Date(); document.getElementById('lastUpdate').innerText = now.toLocaleTimeString();
  renderList(); // update UI
}

/* start fake socket */
setInterval(liveTick, 6000);

/* Send package: add new delivery near map center */
function openModal() { document.getElementById('modalBack').style.display = 'grid'; }
function closeModal() { document.getElementById('modalBack').style.display = 'none'; }
function openTrack() { document.getElementById('trackBack').style.display = 'grid'; }
function closeTrack() { document.getElementById('trackBack').style.display = 'none'; }

document.getElementById('btnQuickSend').addEventListener('click', openModal);
document.getElementById('btnTrack').addEventListener('click', openTrack);

/* handle send form */
function handleSend(e){
  e.preventDefault();
  const sender = document.getElementById('sender').value.trim();
  const receiver = document.getElementById('receiver').value.trim();
  const address = document.getElementById('address').value.trim();
  const eta = parseInt(document.getElementById('eta').value,10) || 30;
  const note = document.getElementById('note').value.trim();
  // generate id
  const id = 'PO-' + (1000 + Math.floor(Math.random()*9000));
  const center = map.getCenter();
  const [lat, lon] = randomNearby(center.lat, center.lng, 1500);
  const newDeliver = { id, sender, receiver, eta, status:'pending', lat, lon, note, address };
  deliveries.unshift(newDeliver);
  upsertMarker(newDeliver);
  renderList();
  closeModal();
  // brief spotlight on marker
  if (markers[id]) { markers[id].openPopup(); setTimeout(()=>markers[id].closePopup(), 2200); }
  return false;
}

/* zoom to marker */
function zoomTo(id) {
  const d = deliveries.find(x=>x.id===id);
  if (!d) return alert('Package not found');
  map.flyTo([d.lat, d.lon], 16, { duration: 1.2 });
  if (markers[id]) markers[id].openPopup();
}

/* mark delivered */
function markDelivered(id){
  const d = deliveries.find(x=>x.id===id);
  if (!d) return;
  d.status = 'delivered'; d.eta = 0;
  upsertMarker(d);
  renderList();
}

/* track by id from modal */
function handleTrack() {
  const id = document.getElementById('trackId').value.trim();
  const d = deliveries.find(x=>x.id === id);
  const feedback = document.getElementById('trackFeedback');
  if (!d) { feedback.innerText = 'Package not found â€” check ID.'; feedback.style.color = '#ffd6d6'; return; }
  feedback.innerText = `Located ${d.id}: ${d.sender} â†’ ${d.receiver} â€¢ Status: ${d.status.toUpperCase()}`;
  feedback.style.color = '#bfeeff';
  zoomTo(id);
}

/* filter list */
function filterList(status) {
  renderList(status);
}

/* utility: mark delivered by id for quick testing */
window.markDelivered = markDelivered;
window.zoomTo = zoomTo;

/* Initial counts */
document.getElementById('activeCount').innerText = deliveries.filter(d=>d.status!=='delivered').length;
document.getElementById('pendingCount').innerText = deliveries.filter(d=>d.status==='pending').length;
document.getElementById('deliveredCount').innerText = deliveries.filter(d=>d.status==='delivered').length;

/* optional: click map to create quick pending delivery (dev helper) */
map.on('click', function(e){
  // small helper: add quick pending package at clicked spot
  const id = 'PO-' + (1000 + Math.floor(Math.random()*9000));
  const newD = { id, sender:'Quick', receiver:'Customer', eta:25, status:'pending', lat:e.latlng.lat, lon:e.latlng.lng, note:'Quick create' };
  deliveries.unshift(newD);
  upsertMarker(newD);
  renderList();
});
</script>
</body>
</html>