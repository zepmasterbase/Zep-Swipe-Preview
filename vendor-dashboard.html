<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zep Swipe Merchants ‚Äî Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>

<style>
:root {
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --glass:rgba(255,255,255,0.06);
  --bg:radial-gradient(circle at 25% 10%, #050018 0%, #000010 100%);
}
body {
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  color:#fff;
  margin:0;
  min-height:100vh;
  overflow-x:hidden;
  padding-bottom:90px;
}

/* ===== Header ===== */
header {
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 18px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(18px);
  border-bottom:1px solid rgba(255,255,255,0.1);
  box-shadow:0 0 18px rgba(0,240,255,0.18);
  position:sticky; top:0; z-index:60;
}
.logo {
  font-family:'Orbitron'; font-weight:700; font-size:1.25rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  text-shadow:0 0 18px rgba(0,240,255,0.6);
}
.logout-btn {
  background:none; border:none; cursor:pointer;
  filter:drop-shadow(0 0 8px var(--zep-blue)); transition:.25s;
}
.logout-btn:hover { transform:scale(1.1); filter:drop-shadow(0 0 12px var(--zep-violet)); }

/* ===== Main ===== */
main { padding:20px; display:flex; flex-direction:column; align-items:center; gap:20px; }

.glass {
  width:100%; max-width:700px;
  background:var(--glass);
  border-radius:18px;
  border:1px solid rgba(255,255,255,0.1);
  padding:22px;
  box-shadow:0 0 25px rgba(0,240,255,0.18);
  backdrop-filter:blur(16px);
  text-align:center;
  animation:pulseCard 3s ease-in-out infinite alternate;
}
@keyframes pulseCard {
  0%{box-shadow:0 0 10px rgba(0,240,255,0.25);}
  100%{box-shadow:0 0 30px rgba(156,77,255,0.45);}
}

.section-title {
  font-family:'Orbitron';
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  font-size:1.25rem; margin-bottom:8px;
}

/* ===== KPI Grid ===== */
.kpi-grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
  margin-top:8px;
}
.kpi {
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:14px;
  padding:14px;
  text-align:center;
  transition:0.3s;
}
.kpi:hover {
  transform:scale(1.03);
  box-shadow:0 0 15px rgba(0,240,255,0.25);
}
.kpi .label { font-size:.8rem; opacity:.8; }
.kpi .value {
  font-family:'Orbitron';
  font-size:1.1rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 0 10px rgba(0,240,255,0.3);
}

/* ===== Footer ===== */
footer {
  position:fixed; bottom:0; left:0; width:100%;
  background:rgba(15,15,30,0.9);
  backdrop-filter:blur(12px);
  border-top:1px solid rgba(255,255,255,0.1);
  display:flex; justify-content:space-around; align-items:center;
  padding:10px 0; z-index:50;
  animation:footerPulse 3s ease-in-out infinite alternate;
}
@keyframes footerPulse {
  0%{box-shadow:0 0 12px rgba(0,240,255,0.25);}
  100%{box-shadow:0 0 28px rgba(156,77,255,0.45);}
}
.footer-icon svg {
  width:28px; height:28px; stroke:var(--zep-blue);
  filter:drop-shadow(0 0 8px var(--zep-violet)); transition:.25s;
}
.footer-icon:hover svg {
  stroke:var(--zep-violet); transform:scale(1.1);
  filter:drop-shadow(0 0 12px var(--zep-blue));
}

/* ===== Zep AI Widget ===== */
#zepAI {
  position: fixed;
  bottom: 80px;
  right: 25px;
  background: linear-gradient(90deg, #00f0ff, #9c4dff);
  border-radius: 14px;
  padding: 12px 20px;
  color: #000010;
  font-family: 'Orbitron';
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 25px rgba(0,240,255,0.4);
  animation: pulseAI 2.5s infinite alternate ease-in-out;
}
@keyframes pulseAI {
  0%{box-shadow:0 0 12px rgba(0,240,255,0.3);}
  100%{box-shadow:0 0 30px rgba(156,77,255,0.8);}
}

/* ===== Responsive ===== */
@media (max-width:600px){
  .logo{font-size:1.1rem;}
  .glass{padding:18px;}
}
</style>
</head>

<body>
<header>
  <div class="logo">Zep Swipe Merchants</div>
  <button class="logout-btn" onclick="logout()" title="Logout">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#00f0ff" viewBox="0 0 24 24" width="26" height="26" stroke-width="1.8">
      <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
      <polyline points="10 17 15 12 10 7"/>
      <line x1="15" y1="12" x2="3" y2="12"/>
    </svg>
  </button>
</header>

<main>
  <div class="glass">
    <h2 class="section-title">üëã Welcome Back</h2>
    <p>Your connected wallet:</p>
    <div id="walletAddress" style="font-family:'Orbitron'; font-size:1rem; opacity:.9; margin-bottom:10px;">‚Äî</div>
  </div>

  <div class="glass">
    <h2 class="section-title">$ZAC Portfolio</h2>
    <p id="zacBalance" style="font-family:'Orbitron'; font-size:1.4rem;">0 ZAC</p>
    <p id="usdValue" style="font-size:.9rem; opacity:.8;">‚âà $0.00 USD</p>
    <p style="font-size:.8rem; opacity:.6;">(Live from Base Network)</p>
  </div>

  <div class="glass">
    <h2 class="section-title">Merchant Dashboard</h2>
    <div class="kpi-grid">
      <a href="orders.html" class="kpi">
        <div class="label">üßæ Orders</div>
        <div class="value">Manage</div>
      </a>
      <a href="withdraw.html" class="kpi">
        <div class="label">üè¶ Withdraw</div>
        <div class="value">ZAC ‚ûú Bank</div>
      </a>
      <a href="analytics.html" class="kpi">
        <div class="label">üìä Analytics</div>
        <div class="value">Insights</div>
      </a>
      <a href="zepshop.html" class="kpi">
        <div class="label">üõçÔ∏è Store</div>
        <div class="value">Open</div>
      </a>
    </div>
  </div>
</main>

<footer>
  <a href="merchants-dashboard.html" class="footer-icon" title="Home">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8"><path d="M3 9.5l9-7 9 7v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-10z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
  </a>
  <a href="wallet.html" class="footer-icon" title="Wallet">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8"><rect x="3" y="6" width="18" height="12" rx="2"/><path d="M16 12h4"/></svg>
  </a>
  <a href="zepshop.html" class="footer-icon" title="Store">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8"><path d="M3 6h18l-2 12H5z"/></svg>
  </a>
  <a href="profile.html" class="footer-icon" title="Profile">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8"><circle cx="12" cy="7" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>
  </a>
</footer>

<!-- Zep AI Widget -->
<div id="zepAI" onclick="toggleAI()">ü§ñ Zep AI Insights</div>

<script>
const BASE_CHAIN_ID = "0x2105"; // Base mainnet
const ZAC_TOKEN_ADDRESS = "0xfe4119a9cac1425d808526905e92386b4234bf2a";
const tokenABI = [
  "function balanceOf(address owner) view returns (uint256)",
  "function decimals() view returns (uint8)"
];
let walletAddress = null;

// === Auto Reconnect ===
window.addEventListener("load", async () => {
  const user = JSON.parse(localStorage.getItem("zepUser"));
  if (!user || !user.wallet || !user.role) {
    window.location.href = "login.html";
    return;
  }
  walletAddress = user.wallet;
  await updateWallet(walletAddress);
  fetchZACBalance(walletAddress);
});

// === Update Wallet Display ===
function updateWallet(addr) {
  document.getElementById("walletAddress").textContent = `${addr.slice(0,6)}...${addr.slice(-4)}`;
}

// === Fetch ZAC Balance ===
async function fetchZACBalance(wallet){
  try {
    const provider = new ethers.JsonRpcProvider("https://mainnet.base.org");
    const contract = new ethers.Contract(ZAC_TOKEN_ADDRESS, tokenABI, provider);
    const decimals = await contract.decimals();
    const balance = await contract.balanceOf(wallet);
    const formatted = Number(ethers.formatUnits(balance, decimals));
    const zacUSD = (formatted * 0.15).toFixed(2);
    document.getElementById("zacBalance").textContent = `${formatted.toFixed(2)} ZAC`;
    document.getElementById("usdValue").textContent = `‚âà $${zacUSD} USD`;
  } catch (err) {
    console.error(err);
    document.getElementById("zacBalance").textContent = "0 ZAC";
  }
}

// === Logout ===
function logout(){
  localStorage.removeItem("zepUser");
  window.location.href="index.html";
}

// === Zep AI ===
function toggleAI(){
  alert("ü§ñ Zep AI is analyzing your store performance! (Coming soon with live insights)");
}
</script>
</body>
</html>